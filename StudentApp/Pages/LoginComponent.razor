@page "/login"
@layout AuthLayout
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Authorization
@using System.ComponentModel.DataAnnotations
@using System.Security.Claims
@using Student.Shared.Models.Authentication
@using StudentApp.Services.AccountManagementService

<PageTitle>Login - Student Portal</PageTitle>

<div class="rz-p-4" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
    <RadzenCard class="rz-shadow-10" Style="width: 100%; max-width: 400px;">
        <RadzenStack Gap="2rem">
            <RadzenStack Gap="1rem" class="rz-text-align-center">
                <RadzenIcon Icon="school" Style="font-size: 4rem; color: var(--rz-primary);" />
                <RadzenText TextStyle="TextStyle.H4" TagName="TagName.H1">Student Portal</RadzenText>
                <RadzenText TextStyle="TextStyle.Subtitle1" class="rz-text-secondary-color">Sign in to your account</RadzenText>
            </RadzenStack>

            <EditForm Model="@_loginModel" OnValidSubmit="@HandleLogin">
                <DataAnnotationsValidator />
                <RadzenStack Gap="1rem">
                    <RadzenFormField Text="Email" Variant="Variant.Outlined">
                        <RadzenTextBox @bind-Value="@_loginModel.Email" Placeholder="Enter your email" Style="width: 100%;" />
                        <ValidationMessage For="@(() => _loginModel.Email)" />
                    </RadzenFormField>

                    <RadzenFormField Text="Password" Variant="Variant.Outlined">
                        <RadzenPassword @bind-Value="@_loginModel.Password" Placeholder="Enter your password" Style="width: 100%" />
                        <ValidationMessage For="@(() => _loginModel.Password)" />
                    </RadzenFormField>

                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenCheckBox @bind-Value="@_loginModel.RememberMe" Name="rememberMe" />
                        <RadzenLabel Text="Remember me" Component="rememberMe" />
                    </RadzenStack>

                    @if (!string.IsNullOrEmpty(errorMessage))
                    {
                        <RadzenAlert AlertStyle="AlertStyle.Danger" Variant="Variant.Flat" Shade="Shade.Lighter">
                            @errorMessage
                        </RadzenAlert>
                    }

                    <RadzenButton ButtonType="ButtonType.Submit" Text="Sign In" Icon="login"
                                  Style="width: 100%" Size="ButtonSize.Large" IsBusy="@isLoading"
                                  Disabled="@(!IsFormValid())" />
                </RadzenStack>
            </EditForm>

            <RadzenStack Gap="1rem" class="rz-text-align-center">
                <RadzenText TextStyle="TextStyle.Body2" class="rz-text-secondary-color">
                    Don't have an account?
                </RadzenText>
                <RadzenButton Text="Create Account" Icon="person_add" ButtonStyle="ButtonStyle.Secondary"
                              Style="width: 100%" Click="@(() => NavigationManager.NavigateTo("/register"))" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>
</div>